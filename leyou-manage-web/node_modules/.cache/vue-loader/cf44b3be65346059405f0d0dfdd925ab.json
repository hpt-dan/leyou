{"remainingRequest":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\form\\Editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\form\\Editor.vue","mtime":1552826060185},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1549812933000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport 'quill/dist/quill.core.css'\nimport 'quill/dist/quill.snow.css'\nimport 'quill/dist/quill.bubble.css'\n\nimport {quillEditor} from 'vue-quill-editor'\nimport fileUtil from './fileUtil';\nexport default {\n  name: \"v-editor\",\n  props: {\n    value: {\n      type: String\n    },\n    /*上传图片的地址*/\n    url: {\n      type: String,\n      default: '/'\n    },\n    /*上传图片的file控件name*/\n    fileName: {\n      type: String,\n      default: 'file'\n    },\n    maxUploadSize:{\n      type:Number,\n      default: 1024 * 1024 * 500\n    },\n    needSignature: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      content: '',\n      editorOption: {\n        modules: {\n          toolbar: '#toolbar'\n        }\n      },\n    }\n  },\n  methods: {\n    onChange() {\n      this.$emit('input', this.content)\n    },\n    /*选择上传图片切换*/\n    async onFileChange(e) {\n      const fileInput = e.target;\n      if (fileInput.files.length === 0) {\n        return\n      }\n      this.editor.focus();\n      if (fileInput.files[0].size > this.maxUploadSize) {\n        this.$alert('图片不能大于500KB', '图片尺寸过大', {\n          confirmButtonText: '确定',\n          type: 'warning',\n        })\n      }\n      let formData = new FormData;\n      let filename = fileInput.files[0].name;\n      let uploadUrl = this.url;\n      // 是否需要签名\n      if(this.needSignature){\n        // 上传到阿里，进行签名，把接收到的url作为签名接口地址\n        const resp = await this.$http.loadData(this.url);\n        // 判断接口返回的签名时间是否超时\n        if (resp.expire < new Date().getTime()) {\n          this.$message.error('请求超时!');\n          return;\n        }\n        // 修改文件名为随机文件名\n        filename = fileUtil.getFileName(filename, resp.dir);\n        // 修改上传文件路径\n        uploadUrl = resp.host;\n        // 准备请求参数\n        formData.append(\"key\", filename);\n        formData.append(\"policy\", resp.policy);\n        formData.append(\"OSSAccessKeyId\", resp.accessId);\n        formData.append(\"success_action_status\", '200');\n        formData.append(\"signature\", resp.signature);\n      }\n      formData.append(this.fileName, fileInput.files[0]);\n      this.$http.post(uploadUrl, formData)\n        .then(resp => {\n          if (resp.status == '200') {\n            const fileUrl = resp.data || uploadUrl + \"/\" + filename;\n            this.editor.insertEmbed(this.editor.getSelection().index, 'image', fileUrl);\n          }\n        }).catch(error => {\n          console.log(error);\n          this.$message.error(\"上传失败，请重试\");\n      })\n    },\n    /*点击上传图片按钮*/\n    imgClick() {\n      if (!this.url) {\n        console.log('no editor uploadUrl');\n        return;\n      }\n      /*内存创建input file*/\n      let input = document.createElement('input');\n      input.type = 'file';\n      input.name = this.fileName;\n      input.accept = 'image/jpeg,image/png,image/jpg,image/gif';\n      input.onchange = this.onFileChange;\n      input.click()\n    }\n  },\n  computed: {\n    editor() {\n      return this.$refs.myTextEditor.quill\n    }\n  },\n  components: {\n    'quilleditor': quillEditor\n  },\n  mounted() {\n    this.content = this.value\n  },\n  watch: {\n    'value'(newVal, oldVal) {\n      if (this.editor) {\n        if (newVal !== this.content) {\n          this.content = newVal\n        }\n      }\n    },\n  }\n}\n\n",{"version":3,"sources":["Editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Editor.vue","sourceRoot":"src/components/form","sourcesContent":["<template>\n  <div>\n    <quilleditor v-model=\"content\"\n                 ref=\"myTextEditor\"\n                 :options=\"editorOption\"\n                 @change=\"onChange\">\n      <div id=\"toolbar\" slot=\"toolbar\">\n        <select class=\"ql-size\">\n          <option value=\"small\"></option>\n          <!-- Note a missing, thus falsy value, is used to reset to default -->\n          <option selected></option>\n          <option value=\"large\"></option>\n          <option value=\"huge\"></option>\n        </select>\n        <!-- Add subscript and superscript buttons -->\n        <span class=\"ql-formats\"><button class=\"ql-script\" value=\"sub\"></button></span>\n        <span class=\"ql-formats\"><button class=\"ql-script\" value=\"super\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-bold\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-italic\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-blockquote\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-list\" value=\"ordered\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-list\" value=\"bullet\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-link\"></button></span>\n        <span class=\"ql-formats\">\n        <button type=\"button\" @click=\"imgClick\" style=\"outline:none\">\n        <svg viewBox=\"0 0 18 18\"> <rect class=\"ql-stroke\" height=\"10\" width=\"12\" x=\"3\" y=\"4\"></rect> <circle\n          class=\"ql-fill\" cx=\"6\" cy=\"7\" r=\"1\"></circle> <polyline class=\"ql-even ql-fill\"\n                                                                  points=\"5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12\"></polyline> </svg>\n        </button>\n      </span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-video\"></button></span>\n      </div>\n    </quilleditor>\n  </div>\n</template>\n<script>\n  import 'quill/dist/quill.core.css'\n  import 'quill/dist/quill.snow.css'\n  import 'quill/dist/quill.bubble.css'\n\n  import {quillEditor} from 'vue-quill-editor'\n  import fileUtil from './fileUtil';\n  export default {\n    name: \"v-editor\",\n    props: {\n      value: {\n        type: String\n      },\n      /*上传图片的地址*/\n      url: {\n        type: String,\n        default: '/'\n      },\n      /*上传图片的file控件name*/\n      fileName: {\n        type: String,\n        default: 'file'\n      },\n      maxUploadSize:{\n        type:Number,\n        default: 1024 * 1024 * 500\n      },\n      needSignature: {\n        type: Boolean,\n        default: false\n      }\n    },\n    data() {\n      return {\n        content: '',\n        editorOption: {\n          modules: {\n            toolbar: '#toolbar'\n          }\n        },\n      }\n    },\n    methods: {\n      onChange() {\n        this.$emit('input', this.content)\n      },\n      /*选择上传图片切换*/\n      async onFileChange(e) {\n        const fileInput = e.target;\n        if (fileInput.files.length === 0) {\n          return\n        }\n        this.editor.focus();\n        if (fileInput.files[0].size > this.maxUploadSize) {\n          this.$alert('图片不能大于500KB', '图片尺寸过大', {\n            confirmButtonText: '确定',\n            type: 'warning',\n          })\n        }\n        let formData = new FormData;\n        let filename = fileInput.files[0].name;\n        let uploadUrl = this.url;\n        // 是否需要签名\n        if(this.needSignature){\n          // 上传到阿里，进行签名，把接收到的url作为签名接口地址\n          const resp = await this.$http.loadData(this.url);\n          // 判断接口返回的签名时间是否超时\n          if (resp.expire < new Date().getTime()) {\n            this.$message.error('请求超时!');\n            return;\n          }\n          // 修改文件名为随机文件名\n          filename = fileUtil.getFileName(filename, resp.dir);\n          // 修改上传文件路径\n          uploadUrl = resp.host;\n          // 准备请求参数\n          formData.append(\"key\", filename);\n          formData.append(\"policy\", resp.policy);\n          formData.append(\"OSSAccessKeyId\", resp.accessId);\n          formData.append(\"success_action_status\", '200');\n          formData.append(\"signature\", resp.signature);\n        }\n        formData.append(this.fileName, fileInput.files[0]);\n        this.$http.post(uploadUrl, formData)\n          .then(resp => {\n            if (resp.status == '200') {\n              const fileUrl = resp.data || uploadUrl + \"/\" + filename;\n              this.editor.insertEmbed(this.editor.getSelection().index, 'image', fileUrl);\n            }\n          }).catch(error => {\n            console.log(error);\n            this.$message.error(\"上传失败，请重试\");\n        })\n      },\n      /*点击上传图片按钮*/\n      imgClick() {\n        if (!this.url) {\n          console.log('no editor uploadUrl');\n          return;\n        }\n        /*内存创建input file*/\n        let input = document.createElement('input');\n        input.type = 'file';\n        input.name = this.fileName;\n        input.accept = 'image/jpeg,image/png,image/jpg,image/gif';\n        input.onchange = this.onFileChange;\n        input.click()\n      }\n    },\n    computed: {\n      editor() {\n        return this.$refs.myTextEditor.quill\n      }\n    },\n    components: {\n      'quilleditor': quillEditor\n    },\n    mounted() {\n      this.content = this.value\n    },\n    watch: {\n      'value'(newVal, oldVal) {\n        if (this.editor) {\n          if (newVal !== this.content) {\n            this.content = newVal\n          }\n        }\n      },\n    }\n  }\n\n</script>\n"]}]}