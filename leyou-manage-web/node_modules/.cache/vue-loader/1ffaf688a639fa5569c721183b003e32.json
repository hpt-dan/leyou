{"remainingRequest":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\form\\Upload.vue?vue&type=style&index=0&id=259169ec&scoped=true&lang=css&","dependencies":[{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\form\\Upload.vue","mtime":1552482654708},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1549812933000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.logo-uploader {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n  float: left;\n}\n\n.logo-uploader:hover {\n  border-color: #409EFF;\n}\n\n.logo-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  text-align: center;\n}\n\n.remove-btn {\n  position: absolute;\n  right: 0;\n  font-size: 16px;\n}\n\n.remove-btn:hover {\n  color: #c22;\n}\n",{"version":3,"sources":["Upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Upload.vue","sourceRoot":"src/components/form","sourcesContent":["<template>\n  <div>\n    <el-upload v-if=\"multiple\"\n               action=\"\"\n               list-type=\"picture-card\"\n               :on-preview=\"handlePictureCardPreview\"\n               :on-remove=\"handleRemove\"\n               ref=\"multiUpload\"\n               :file-list=\"fileList\"\n               :http-request=\"handleUpload\"\n    >\n      <i class=\"el-icon-plus\"></i>\n    </el-upload>\n    <el-upload ref=\"singleUpload\" v-else\n               action=\"\"\n               :style=\"avatarStyle\"\n               class=\"logo-uploader\"\n               :show-file-list=\"false\"\n               :http-request=\"handleUpload\"\n    >\n      <div @mouseover=\"showBtn=true\" @mouseout=\"showBtn=false\">\n        <i @click.stop=\"removeSingle\" v-show=\"dialogImageUrl && showBtn\" class=\"el-icon-close remove-btn\"></i>\n        <img v-if=\"dialogImageUrl\" :src=\"dialogImageUrl\" :style=\"avatarStyle\">\n        <i v-else class=\"el-icon-plus logo-uploader-icon\" :style=\"avatarStyle\"></i>\n      </div>\n    </el-upload>\n    <v-dialog v-model=\"show\" max-width=\"500\">\n      <img width=\"500px\" :src=\"dialogImageUrl\" alt=\"\">\n    </v-dialog>\n  </div>\n</template>\n\n<script>\n  import {Upload} from 'element-ui';\n  import fileUtil from './fileUtil';\n\n\n  export default {\n    name: \"vUpload\",\n    components: {\n      elUpload: Upload\n    },\n    props: {\n      url: {\n        type: String,\n        require: false\n      },\n      value: {},\n      multiple: {\n        type: Boolean,\n        default: true\n      },\n      picWidth: {\n        type: Number,\n        default: 150\n      },\n      picHeight: {\n        type: Number,\n        default: 150\n      },\n      needSignature: {\n        type: Boolean,\n        default: false\n      }\n    },\n    data() {\n      return {\n        showBtn: false,\n        show: false,\n        dialogImageUrl: \"\",\n        avatarStyle: {\n          width: this.picWidth + 'px',\n          height: this.picHeight + 'px',\n          'line-height': this.picHeight + 'px'\n        },\n        fileList: [],\n      }\n    },\n    mounted() {\n      if (!this.value || this.value.length <= 0) {\n        return;\n      }\n      if (this.multiple) {\n        this.fileList = this.value.map(f => {\n          return {response: f, url: f}\n        });\n      } else {\n        this.dialogImageUrl = this.value;\n      }\n    },\n    watch: {\n      value:{\n        deep: true,\n        handler(val){\n          if((typeof val) === \"string\"){\n            this.dialogImageUrl = val;\n          }\n        }\n      }\n    },\n    methods: {\n      async handleUpload(params) {\n        const file = params.file;\n        const fileType = file.type;\n        const isImage = fileType.indexOf('image') !== -1;\n\n        const isLt2M = file.size < 2 * 1024 * 1024;\n\n        if (!isLt2M) {\n          this.$message.error('上传图片或视频大小不能超过 2MB!');\n          return;\n        }\n\n        if (!isImage) {\n          this.$message.error('请选择图片!');\n          return;\n        }\n        // 准备文件名称\n        let filename = file.name;\n        let uploadUrl = this.url;\n        // 准备上传表单\n        const formData = new FormData();\n        // 判断上传到哪里\n        if (this.needSignature) {\n          // 上传到阿里，进行签名，把接收到的url作为签名接口地址\n          const resp = await this.$http.loadData(this.url);\n          // 判断接口返回的签名时间是否超时\n          if (resp.expire < new Date().getTime()) {\n            this.$message.error('请求超时!');\n            return;\n          }\n          // 修改文件名为随机文件名\n          filename = fileUtil.getFileName(file.name, resp.dir);\n          // 修改上传文件路径\n          uploadUrl = resp.host;\n          // 准备请求参数\n          formData.append(\"key\", filename);\n          formData.append(\"policy\", resp.policy);\n          formData.append(\"OSSAccessKeyId\", resp.accessId);\n          formData.append(\"success_action_status\", '200');\n          formData.append(\"signature\", resp.signature);\n        }\n        formData.append(\"file\", file);\n\n        this.$http.post(uploadUrl, formData, {headers: {'Content-Type': 'multipart/form-data'}})\n          .then(resp => {\n            console.log(resp);\n            if (resp.status == '200') {\n              // 获取文件路径\n              const fileUrl = resp.data || uploadUrl + \"/\" + filename;\n              // 判断是多文件还是单文件\n              if (!this.multiple) {\n                // 单文件，直接获取地址即可；\n                this.dialogImageUrl = fileUrl;\n                this.$emit(\"input\", fileUrl)\n              } else {\n                // 多文件，放到集合中\n                const files = this.$refs.multiUpload.uploadFiles;\n                files[files.length - 1].response = fileUrl;\n                this.fileList = files;\n                this.$emit(\"input\", files.map(f => f.response))\n              }\n            } else {\n              this.$message.error('上传失败');\n            }\n          }).catch(function (err) {\n          this.$message.error('上传失败');\n          console.log(err);\n        });\n      },\n      handleRemove(file, fileList) {\n        this.fileList = fileList;\n        this.$emit(\"input\", fileList.map(f => f.response))\n      },\n      handlePictureCardPreview(file) {\n        this.dialogImageUrl = file.response;\n        this.show = true;\n      },\n      removeSingle() {\n        this.dialogImageUrl = \"\";\n        this.$refs.singleUpload.clearFiles();\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  .logo-uploader {\n    border: 1px dashed #d9d9d9;\n    border-radius: 6px;\n    cursor: pointer;\n    position: relative;\n    overflow: hidden;\n    float: left;\n  }\n\n  .logo-uploader:hover {\n    border-color: #409EFF;\n  }\n\n  .logo-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    text-align: center;\n  }\n\n  .remove-btn {\n    position: absolute;\n    right: 0;\n    font-size: 16px;\n  }\n\n  .remove-btn:hover {\n    color: #c22;\n  }\n</style>\n"]}]}