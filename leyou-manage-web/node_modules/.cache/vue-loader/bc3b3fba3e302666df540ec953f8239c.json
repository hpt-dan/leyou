{"remainingRequest":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\cascader\\Cascader.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\cascader\\Cascader.vue","mtime":1552471471473},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1549812933000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {Cascader} from 'iview'\nimport 'iview/dist/styles/iview.css';\n\nexport default {\n  name: \"vCascader\",\n  components: {\n    cas: Cascader\n  },\n  props: {\n    value: {},\n    label: {\n      type: String\n    },\n    url: {\n      type: String\n    },\n    itemText: {\n      type: String,\n      default: 'name'\n    },\n    itemValue: {\n      type: String,\n      default: 'id'\n    },\n    children: {\n      type: String,\n      default: 'children'\n    },\n    multiple: {\n      type: Boolean,\n      default: false\n    },\n    showAllLevels: {\n      type: Boolean,\n      default: false\n    },\n    required:{\n      type: Boolean,\n      default: false\n    },\n    rules:{\n      type:Array,\n    }\n  },\n  data() {\n    return {\n      options: [],\n      selected: [],\n      defaultRules:[]\n    }\n  },\n  methods: {\n    handleChange(value, selectedData) {\n      // 获取最后一级\n      const option = selectedData[selectedData.length - 1];\n      // 如果是多选，则默认只保存最后一级选项\n      if (this.multiple) {\n        // 将最后一级保存到selected中\n        if (this.selected.findIndex(o => o.value === option.value) < 0) {\n          this.selected.push(option);\n        }\n        // 返回已选中的值\n        this.$emit(\"input\", this.transfer(this.selected));\n      } else {\n        // 单选，则需要判断是否需要显示所有级别\n        if (this.showAllLevels) {\n          // 显示所有级别,将各级别label进行拼接\n          this.selected = [option.__label];\n          // 返回id数组\n          this.$emit(\"input\", this.transfer(selectedData));\n        } else {\n          // 只显示最后一级\n          this.selected = [option.label];\n          // 返回\n          this.$emit(\"input\", this.transfer([option])[0]);\n        }\n      }\n    },\n    loadOption(item, callback) {// 延迟加载次级选项\n      item.loading = true;\n      this.loadData(item.value).then(data => {\n        item.children = data;\n        item.loading = false;\n        callback();\n      }).catch(() => {\n        item.loading = false;\n        callback();\n      })\n    },\n    loadData(pid) {// 从指定的url地址加载数据，并格式化\n      return new Promise((resolve) => {\n        this.$http.get(this.url, {\n          params: {\n            pid: pid\n          }\n        }).then(resp => {\n          const data = [];\n          for (let d of resp.data) {\n            const node = {\n              value: d[this.itemValue],\n              label: d[this.itemText]\n            }\n            if (d.isParent) {\n              node['children'] = [];\n              node['loading'] = false;\n            }\n            data.push(node)\n          }\n          resolve(data);\n        })\n      })\n    },\n    remove(item) {\n      this.selected = this.selected.filter(o => o.value !== item.value)\n      this.$emit(\"input\", this.transfer(this.selected))\n    },\n    transfer(arr) {\n      return arr.map(({label, value}) => {\n        const obj = {};\n        obj[this.itemText] = label;\n        obj[this.itemValue] = value;\n        return obj;\n      })\n    },\n    validate(){\n      if(this.required){\n        this.$refs.form.validate();\n      }\n    }\n  },\n  created() {\n    this.loadData(0).then(data => {\n      this.options = data;\n    })\n    if(this.required){\n      this.defaultRules.push(v => v.length > 0 || this.label + \"不能为空\");\n    }\n    if(this.rules){\n      this.rules.forEach(r => this.defaultRules.push(r));\n    }\n  },\n  watch: {\n    value: {\n      deep: true,\n      handler(val) {\n        if(!val){\n          this.selected = [];\n          return;\n        }\n        if(val && this.showAllLevels && !this.multiple){\n          this.selected = [val.map(o => o[this.itemText]).join(\"/\")]\n        } else if (this.multiple && val) {\n          this.selected = val.map(o => {\n            return {\n              label: o[this.itemText],\n              value: o[this.itemValue]\n            }\n          })\n        } else{\n          this.selected = [val[this.itemText]]\n        }\n      }\n    }\n  }\n}\n",{"version":3,"sources":["Cascader.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;AAeA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Cascader.vue","sourceRoot":"src/components/cascader","sourcesContent":["<template>\n  <cas :data=\"options\" @on-change=\"handleChange\" :loadData=\"loadOption\" transfer>\n    <v-combobox multiple :label=\"label\" chips clearable v-model=\"selected\" :required=\"required\"\n      :rules=\"defaultRules\">\n      <template v-slot:selection=\"{ item, parent, selected }\">\n        <v-chip @click.stop=\"\" v-if=\"multiple\" close @input=\"remove(item)\" small outline color=\"green\">\n          {{ item.label}}&nbsp;\n        </v-chip>\n        <v-chip @click.stop=\"\" v-else small>{{ item}}</v-chip>\n      </template>\n    </v-combobox>\n  </cas>\n</template>\n\n<script>\n  import {Cascader} from 'iview'\n  import 'iview/dist/styles/iview.css';\n\n  export default {\n    name: \"vCascader\",\n    components: {\n      cas: Cascader\n    },\n    props: {\n      value: {},\n      label: {\n        type: String\n      },\n      url: {\n        type: String\n      },\n      itemText: {\n        type: String,\n        default: 'name'\n      },\n      itemValue: {\n        type: String,\n        default: 'id'\n      },\n      children: {\n        type: String,\n        default: 'children'\n      },\n      multiple: {\n        type: Boolean,\n        default: false\n      },\n      showAllLevels: {\n        type: Boolean,\n        default: false\n      },\n      required:{\n        type: Boolean,\n        default: false\n      },\n      rules:{\n        type:Array,\n      }\n    },\n    data() {\n      return {\n        options: [],\n        selected: [],\n        defaultRules:[]\n      }\n    },\n    methods: {\n      handleChange(value, selectedData) {\n        // 获取最后一级\n        const option = selectedData[selectedData.length - 1];\n        // 如果是多选，则默认只保存最后一级选项\n        if (this.multiple) {\n          // 将最后一级保存到selected中\n          if (this.selected.findIndex(o => o.value === option.value) < 0) {\n            this.selected.push(option);\n          }\n          // 返回已选中的值\n          this.$emit(\"input\", this.transfer(this.selected));\n        } else {\n          // 单选，则需要判断是否需要显示所有级别\n          if (this.showAllLevels) {\n            // 显示所有级别,将各级别label进行拼接\n            this.selected = [option.__label];\n            // 返回id数组\n            this.$emit(\"input\", this.transfer(selectedData));\n          } else {\n            // 只显示最后一级\n            this.selected = [option.label];\n            // 返回\n            this.$emit(\"input\", this.transfer([option])[0]);\n          }\n        }\n      },\n      loadOption(item, callback) {// 延迟加载次级选项\n        item.loading = true;\n        this.loadData(item.value).then(data => {\n          item.children = data;\n          item.loading = false;\n          callback();\n        }).catch(() => {\n          item.loading = false;\n          callback();\n        })\n      },\n      loadData(pid) {// 从指定的url地址加载数据，并格式化\n        return new Promise((resolve) => {\n          this.$http.get(this.url, {\n            params: {\n              pid: pid\n            }\n          }).then(resp => {\n            const data = [];\n            for (let d of resp.data) {\n              const node = {\n                value: d[this.itemValue],\n                label: d[this.itemText]\n              }\n              if (d.isParent) {\n                node['children'] = [];\n                node['loading'] = false;\n              }\n              data.push(node)\n            }\n            resolve(data);\n          })\n        })\n      },\n      remove(item) {\n        this.selected = this.selected.filter(o => o.value !== item.value)\n        this.$emit(\"input\", this.transfer(this.selected))\n      },\n      transfer(arr) {\n        return arr.map(({label, value}) => {\n          const obj = {};\n          obj[this.itemText] = label;\n          obj[this.itemValue] = value;\n          return obj;\n        })\n      },\n      validate(){\n        if(this.required){\n          this.$refs.form.validate();\n        }\n      }\n    },\n    created() {\n      this.loadData(0).then(data => {\n        this.options = data;\n      })\n      if(this.required){\n        this.defaultRules.push(v => v.length > 0 || this.label + \"不能为空\");\n      }\n      if(this.rules){\n        this.rules.forEach(r => this.defaultRules.push(r));\n      }\n    },\n    watch: {\n      value: {\n        deep: true,\n        handler(val) {\n          if(!val){\n            this.selected = [];\n            return;\n          }\n          if(val && this.showAllLevels && !this.multiple){\n            this.selected = [val.map(o => o[this.itemText]).join(\"/\")]\n          } else if (this.multiple && val) {\n            this.selected = val.map(o => {\n              return {\n                label: o[this.itemText],\n                value: o[this.itemValue]\n              }\n            })\n          } else{\n            this.selected = [val[this.itemText]]\n          }\n        }\n      }\n    }\n  }\n</script>\n\n<style scoped>\n  .ivu-cascader-menu-item {\n    font-size: 14px;\n  }\n\n</style>\n"]}]}