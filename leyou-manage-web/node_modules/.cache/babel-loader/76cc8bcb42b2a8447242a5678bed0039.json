{"remainingRequest":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\babel-loader\\lib\\index.js!C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vuetify-loader\\lib\\loader.js!C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\form\\Editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\src\\components\\form\\Editor.vue","mtime":1552826060185},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1549812933000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\develop\\idea-projects\\leyou-manage-web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\develop\\\\idea-projects\\\\leyou-manage-web\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport 'quill/dist/quill.core.css';\nimport 'quill/dist/quill.snow.css';\nimport 'quill/dist/quill.bubble.css';\nimport { quillEditor } from 'vue-quill-editor';\nimport fileUtil from './fileUtil';\nexport default {\n  name: \"v-editor\",\n  props: {\n    value: {\n      type: String\n    },\n\n    /*上传图片的地址*/\n    url: {\n      type: String,\n      default: '/'\n    },\n\n    /*上传图片的file控件name*/\n    fileName: {\n      type: String,\n      default: 'file'\n    },\n    maxUploadSize: {\n      type: Number,\n      default: 1024 * 1024 * 500\n    },\n    needSignature: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      content: '',\n      editorOption: {\n        modules: {\n          toolbar: '#toolbar'\n        }\n      }\n    };\n  },\n  methods: {\n    onChange: function onChange() {\n      this.$emit('input', this.content);\n    },\n\n    /*选择上传图片切换*/\n    onFileChange: function () {\n      var _onFileChange = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(e) {\n        var _this = this;\n\n        var fileInput, formData, filename, uploadUrl, resp;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                fileInput = e.target;\n\n                if (!(fileInput.files.length === 0)) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                this.editor.focus();\n\n                if (fileInput.files[0].size > this.maxUploadSize) {\n                  this.$alert('图片不能大于500KB', '图片尺寸过大', {\n                    confirmButtonText: '确定',\n                    type: 'warning'\n                  });\n                }\n\n                formData = new FormData();\n                filename = fileInput.files[0].name;\n                uploadUrl = this.url; // 是否需要签名\n\n                if (!this.needSignature) {\n                  _context.next = 22;\n                  break;\n                }\n\n                _context.next = 11;\n                return this.$http.loadData(this.url);\n\n              case 11:\n                resp = _context.sent;\n\n                if (!(resp.expire < new Date().getTime())) {\n                  _context.next = 15;\n                  break;\n                }\n\n                this.$message.error('请求超时!');\n                return _context.abrupt(\"return\");\n\n              case 15:\n                // 修改文件名为随机文件名\n                filename = fileUtil.getFileName(filename, resp.dir); // 修改上传文件路径\n\n                uploadUrl = resp.host; // 准备请求参数\n\n                formData.append(\"key\", filename);\n                formData.append(\"policy\", resp.policy);\n                formData.append(\"OSSAccessKeyId\", resp.accessId);\n                formData.append(\"success_action_status\", '200');\n                formData.append(\"signature\", resp.signature);\n\n              case 22:\n                formData.append(this.fileName, fileInput.files[0]);\n                this.$http.post(uploadUrl, formData).then(function (resp) {\n                  if (resp.status == '200') {\n                    var fileUrl = resp.data || uploadUrl + \"/\" + filename;\n\n                    _this.editor.insertEmbed(_this.editor.getSelection().index, 'image', fileUrl);\n                  }\n                }).catch(function (error) {\n                  console.log(error);\n\n                  _this.$message.error(\"上传失败，请重试\");\n                });\n\n              case 24:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function onFileChange(_x) {\n        return _onFileChange.apply(this, arguments);\n      }\n\n      return onFileChange;\n    }(),\n\n    /*点击上传图片按钮*/\n    imgClick: function imgClick() {\n      if (!this.url) {\n        console.log('no editor uploadUrl');\n        return;\n      }\n      /*内存创建input file*/\n\n\n      var input = document.createElement('input');\n      input.type = 'file';\n      input.name = this.fileName;\n      input.accept = 'image/jpeg,image/png,image/jpg,image/gif';\n      input.onchange = this.onFileChange;\n      input.click();\n    }\n  },\n  computed: {\n    editor: function editor() {\n      return this.$refs.myTextEditor.quill;\n    }\n  },\n  components: {\n    'quilleditor': quillEditor\n  },\n  mounted: function mounted() {\n    this.content = this.value;\n  },\n  watch: {\n    'value': function value(newVal, oldVal) {\n      if (this.editor) {\n        if (newVal !== this.content) {\n          this.content = newVal;\n        }\n      }\n    }\n  }\n};",{"version":3,"sources":["Editor.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <quilleditor v-model=\"content\"\n                 ref=\"myTextEditor\"\n                 :options=\"editorOption\"\n                 @change=\"onChange\">\n      <div id=\"toolbar\" slot=\"toolbar\">\n        <select class=\"ql-size\">\n          <option value=\"small\"></option>\n          <!-- Note a missing, thus falsy value, is used to reset to default -->\n          <option selected></option>\n          <option value=\"large\"></option>\n          <option value=\"huge\"></option>\n        </select>\n        <!-- Add subscript and superscript buttons -->\n        <span class=\"ql-formats\"><button class=\"ql-script\" value=\"sub\"></button></span>\n        <span class=\"ql-formats\"><button class=\"ql-script\" value=\"super\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-bold\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-italic\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-blockquote\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-list\" value=\"ordered\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-list\" value=\"bullet\"></button></span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-link\"></button></span>\n        <span class=\"ql-formats\">\n        <button type=\"button\" @click=\"imgClick\" style=\"outline:none\">\n        <svg viewBox=\"0 0 18 18\"> <rect class=\"ql-stroke\" height=\"10\" width=\"12\" x=\"3\" y=\"4\"></rect> <circle\n          class=\"ql-fill\" cx=\"6\" cy=\"7\" r=\"1\"></circle> <polyline class=\"ql-even ql-fill\"\n                                                                  points=\"5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12\"></polyline> </svg>\n        </button>\n      </span>\n        <span class=\"ql-formats\"><button type=\"button\" class=\"ql-video\"></button></span>\n      </div>\n    </quilleditor>\n  </div>\n</template>\n<script>\n  import 'quill/dist/quill.core.css'\n  import 'quill/dist/quill.snow.css'\n  import 'quill/dist/quill.bubble.css'\n\n  import {quillEditor} from 'vue-quill-editor'\n  import fileUtil from './fileUtil';\n  export default {\n    name: \"v-editor\",\n    props: {\n      value: {\n        type: String\n      },\n      /*上传图片的地址*/\n      url: {\n        type: String,\n        default: '/'\n      },\n      /*上传图片的file控件name*/\n      fileName: {\n        type: String,\n        default: 'file'\n      },\n      maxUploadSize:{\n        type:Number,\n        default: 1024 * 1024 * 500\n      },\n      needSignature: {\n        type: Boolean,\n        default: false\n      }\n    },\n    data() {\n      return {\n        content: '',\n        editorOption: {\n          modules: {\n            toolbar: '#toolbar'\n          }\n        },\n      }\n    },\n    methods: {\n      onChange() {\n        this.$emit('input', this.content)\n      },\n      /*选择上传图片切换*/\n      async onFileChange(e) {\n        const fileInput = e.target;\n        if (fileInput.files.length === 0) {\n          return\n        }\n        this.editor.focus();\n        if (fileInput.files[0].size > this.maxUploadSize) {\n          this.$alert('图片不能大于500KB', '图片尺寸过大', {\n            confirmButtonText: '确定',\n            type: 'warning',\n          })\n        }\n        let formData = new FormData;\n        let filename = fileInput.files[0].name;\n        let uploadUrl = this.url;\n        // 是否需要签名\n        if(this.needSignature){\n          // 上传到阿里，进行签名，把接收到的url作为签名接口地址\n          const resp = await this.$http.loadData(this.url);\n          // 判断接口返回的签名时间是否超时\n          if (resp.expire < new Date().getTime()) {\n            this.$message.error('请求超时!');\n            return;\n          }\n          // 修改文件名为随机文件名\n          filename = fileUtil.getFileName(filename, resp.dir);\n          // 修改上传文件路径\n          uploadUrl = resp.host;\n          // 准备请求参数\n          formData.append(\"key\", filename);\n          formData.append(\"policy\", resp.policy);\n          formData.append(\"OSSAccessKeyId\", resp.accessId);\n          formData.append(\"success_action_status\", '200');\n          formData.append(\"signature\", resp.signature);\n        }\n        formData.append(this.fileName, fileInput.files[0]);\n        this.$http.post(uploadUrl, formData)\n          .then(resp => {\n            if (resp.status == '200') {\n              const fileUrl = resp.data || uploadUrl + \"/\" + filename;\n              this.editor.insertEmbed(this.editor.getSelection().index, 'image', fileUrl);\n            }\n          }).catch(error => {\n            console.log(error);\n            this.$message.error(\"上传失败，请重试\");\n        })\n      },\n      /*点击上传图片按钮*/\n      imgClick() {\n        if (!this.url) {\n          console.log('no editor uploadUrl');\n          return;\n        }\n        /*内存创建input file*/\n        let input = document.createElement('input');\n        input.type = 'file';\n        input.name = this.fileName;\n        input.accept = 'image/jpeg,image/png,image/jpg,image/gif';\n        input.onchange = this.onFileChange;\n        input.click()\n      }\n    },\n    computed: {\n      editor() {\n        return this.$refs.myTextEditor.quill\n      }\n    },\n    components: {\n      'quilleditor': quillEditor\n    },\n    mounted() {\n      this.content = this.value\n    },\n    watch: {\n      'value'(newVal, oldVal) {\n        if (this.editor) {\n          if (newVal !== this.content) {\n            this.content = newVal\n          }\n        }\n      },\n    }\n  }\n\n</script>\n"],"sourceRoot":"src/components/form"}]}